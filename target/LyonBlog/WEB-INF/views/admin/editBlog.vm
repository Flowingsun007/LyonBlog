<!doctype html>
<html lang="zh">
<head>
    <!-- Meta-Tags -->
    <meta charset="utf-8">

    <title>é˜³å…‰æµæ·Œçš„ä¸ªäººåšå®¢</title>
    <!-- Bootstrap core CSS -->
    <link href="/static/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="/static/css/blogHome.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/writeBlog.css" />
    <!-- This is what you need -->
    <script src="/static/js/sweetalert-dev.js"></script>
    <link rel="stylesheet" href="/static/css/sweetalert.css">
    <!--Editormd-->
    <link rel="stylesheet" href="/static/Editormd/css/editormd.min.css" />
    <link rel="shortcut icon" href="https://pandao.github.io/editor.md/favicon.ico" type="image/x-icon" />
    <!-- Bootstrap related Jquery -->
    <script src="/static/jquery/jquery-2.2.3.min.js" ></script>
    <!-- Bootstrap core JavaScript-->
    <!--================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script>window.jQuery || document.write('<script src="/static/bootstrap/assets/js/vendor/jquery-slim.min.js"><\/script>')</script>
    <script src="/static/bootstrap/assets/js/vendor/popper.min.js"></script>
    <script src="/static/bootstrap/dist/js/bootstrap.min.js"></script>

</head>
<body>
<script type="text/javascript">
    $(function(){
        $("#inputnewTag").keyup(function(e){
            if(e.keyCode == 13){
                var value = $("#inputnewTag").val();
                $("#addnewTag").click();
            }
        });

        $("#tagDiv").on("click","#addnewTag",function() {
            var tagName = $('#inputnewTag').val();
            if (tagName==''){
                swal("è¯·è¾“å…¥æ ‡ç­¾å†…å®¹ğŸ˜¶ï¼");
                return false;
            }else{
                $('#inputnewTag').val('');
                var newTag = document.createElement("a");
                var farther = document.getElementById('tagDiv');
                newTag.setAttribute("class", "anewTag");
                newTag.setAttribute("title", tagName);
                newTag.setAttribute("style", "margin-left: 8px;");
                newTag.innerHTML = '<span type="button" class="btn btn-success btn-sm" style="font-size: 13px;background-color:#555;">'+tagName+'</span><button type="button" id="closeTag" style="display: none"  class="close" aria-label="Close"><span aria-hidden="true" style="color: #FF0000">&times;</span></button>';
                farther.appendChild(newTag);
            }
        });


        $('#tagDiv').on("mouseenter",".anewTag",function(){
            var a = $(this).children('span');
            var b = $(this).children('button');
            a.css("color","#8175ff");
            a.css("background-color","");
            b.css("display","block");
        });
        $('#tagDiv').on("mouseleave",".anewTag",function(){
            var a = $(this).children('span');
            var b = $(this).children('button');
            a.css("color","#f6fffc");
            a.css("background-color","#555");
            b.css("display","none");
        });
        $('#tagDiv').on("click","#closeTag",function(){
            var mother = $(this).parents('.anewTag');
            mother.remove();
        });

        $('#blogMainCat').change(function(){
            var select1 = $('#blogMainCat');
            var select2 = $('#blogSecondCat');
            var options1 = $('#blogMainCat option:selected');
            var options2 = $('#blogSecondCat option:selected');
            if(options1.val()!=0){
                $.ajax({
                    cache:true,
                    type:"POST",
                    url:"/admin/categorySelect",
                    async: false,
                    data:{
                        'mId':options1.val()
                    },
                    dataType:'text',
                    error:function(request){
                        alert("ğŸ’”ç™»å½•å¤±è´¥ï¼šConnection error:"+request.error);
                    },
                    success:function(data) {
                        select2.children().remove();
                        var result = data.split(";");
                        for(var i=0;i<result.length;i++){
                            var alist = result[i].split(":");
                            var cId = alist[0];
                            var cidName = alist[1];
                            select2.append('<option value="'+cId+'">'+cidName+'</option>');
                        }
                    }
                });
            }
        });

    })
</script>
<script type="text/javascript">
    function submitCheck(){
        // a,b,c,d,e,f,gåˆ†åˆ«ä¸ºæ–‡ç« æ ‡é¢˜ï¼Œæ–‡ç« æ‘˜è¦ï¼Œæ–‡ç« ä¸»åˆ†ç±»idï¼Œæ–‡ç« äºŒçº§åˆ†ç±»idï¼Œæ–‡ç« HTMLå†…å®¹,æ–‡ç« markdownåŸæ–‡,æ–‡ç« æ ‡ç­¾(ä»¥tag1,tag2,...å­—ç¬¦ä¸²å½¢å¼è¿”å›))
        var id = $article.getId();
        var a = $('#blogTitle').val();
        var b = $('#blogSubtitle').val();
        var c = $('#blogMainCat option:selected').val();
        var d = $('#blogSecondCat option:selected').val();
        var e = testEditor.getPreviewedHTML();          // è·å–å³ä¾§é¢„è§ˆåŒºé‡Œçš„æ¸²æŸ“è¿‡æ•ˆæœçš„HTML(ç›´æ¥æäº¤æ­¤å†…å®¹å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ä½œä¸ºæ–‡ç« ä¸»ä½“å†…å®¹ï¼Œä¸‹æ¬¡å–å‡ºåå¯ç›´æ¥åœ¨å‰å°æ˜¾ç¤º))ã€‚
        var f = $(".editormd-markdown-textarea").val(); // è·å–å·¦ä¾§ç¼–è¾‘åŒºé‡Œmarkdownæ ¼å¼çš„å†…å®¹
        var taglist = [];
        var tags = document.getElementsByClassName("anewTag");
        for(var i = 0; i < tags.length; i++){
            taglist.push(tags[i].getAttribute('title'));
        }
        if ((a=='')||(b=='')||(taglist.length==0)){
            swal("æ–‡ç« æ ‡é¢˜ã€æ‘˜è¦ã€æ ‡ç­¾å‡ä¸èƒ½ä¸ºç©ºï¼ï¼ï¼");
            return false;
        }else{
            var g = taglist.join();
            var tt = "æ‚¨åˆ›å»ºäº†"+taglist.length+"ä¸ªæ ‡ç­¾ï¼š";
            swal({
                title: tt,
                text: g,
                timer: 5000,
                showConfirmButton: false
            });
            //alert("æ‚¨åˆ›å»ºäº†"+taglist.length+"ä¸ªæ ‡ç­¾ï¼š" + g);
            if (e==''||f==''){
                swal("äº²ï¼Œè¯·å¡«å†™æ–‡ç« å†…å®¹ï¼Œä¸èƒ½æäº¤ç©ºæ–‡ç« ğŸ˜¶ï¼");
                return false;
            }else{
                if(confirm('ç¡®å®šæäº¤ç¼–è¾‘ä¹ˆï¼Ÿ')) {
                    $.ajax({
                        type:"POST",
                        contentType: "application/json",
                        url:"/admin/editBlog/submit",
                        data:JSON.stringify({"id":id,"articleTitle":a,"articleAbstract":b,"articleMainId":c,"articleSecondId":d,"articleContent":e,"articleContentCopy":f,"articleTags":g}),
                        success:function (data) {
                            if(data=="edit_blog_success"){
                                swal("æ–‡ç« ç¼–è¾‘æˆåŠŸğŸ˜Šï¼");
                            } else if(data=="edit_blog_fail"){
                                swal("æ–‡ç« ç¼–è¾‘å¤±è´¥ğŸ˜Šï¼");
                            }
                        }
                    });
                    return false;
                }else{
                    return false;
                }
            }
        }
    };
</script>

<h1>ç¼–è¾‘åšå®¢æ–‡ç« </h1>
<hr>

<main role="main" class="container">
<div class="row">
    <div class="col-md-12 blog-main">

        <div class="blog-post">
            <div>
                <h2 class="blog-post-title"><a href="/article/single?articleId=$article.getId()">$article.getArticleTitle()</a></h2>
                <p><span style="font-size:12px;font-family:Vincent;font-weight:100;color:#66CDAA;">æ–‡ç« åˆ†ç±»:</span>
                    <span>$article.getMainCategoryName()-></span>
                    <a  href="/article/category?cId=$article.getArticleSecondId()">$article.getSecondCategoryName()</a>
                </p>
                <span id="articleMainId" style="visibility: hidden">$article.getArticleMainId()</span>
                <span id="articleSecondId" style="visibility: hidden">$article.getArticleSecondId()</span>
                <div>
                    <h3 class="font-italic" style="color:#9F79EE;font-size:15px">Tags:
                        #set($tags = $article.getArticleTagList())
                        #foreach($tag in $!{tags})
                            <a href="/article/tag?tagId=$tag.tagId">$tag.tagName</a>
                        #end
                    </h3>
                    <p>Lyon åˆ›å»ºäºï¼š<span> $!date.format('yyyy-MM-dd HH:mm',$!article.getCreateDate())</span></p>
                </div>

            </div>



        </div><!-- /.blog-post -->



        <div class="linkandshare-mainarticle">

            <a href="javascript:void(0)" onclick="submitThank()" style="margin-right:30px;color:#919191;" class="submitThank" id="submitThank">
                #if($article.getBehaviorStatus().getThankStatus()==1)
                    <img class="icon" src="/static/image/thank2.png" alt="thank" width="15px;" height="15px;">
                #else
                    <img class="icon" src="/static/image/thank1.png" alt="thank" width="15px;" height="15px;">
                #end
                <span id="thankNum">
                    #if(!$article.getArticleThank())
                                0
                    #else
                        $article.getArticleThank()
                    #end</span>æ„Ÿè°¢</a>


        ##                        <img class="icon" src="/static/open-iconic/svg/comment-square.svg" alt="comment-square">
            <a href="javascript:void(0)" onclick="showCommentArea()" style="margin-right:40px;color:#919191;" id="commentIcon">
                #if($article.getBehaviorStatus().getCommentStatus()==1)
                    <img class="icon" src="/static/image/comment2.png" alt="comment" width="15px;" height="15px;">
                #else
                    <img class="icon" src="/static/image/comment1.png" alt="comment" width="15px;" height="15px;">
                #end
                <span>
                    #if(!$article.getArticleComment())
                                0
                    #else
                        $article.getArticleComment()
                    #end
                </span>è¯„è®º</a>


            <a href="" style="margin-right:40px;color:#919191;" id="submitSave"><img class="icon" src="/static/image/save1.png" alt="star" width="17px;" height="17px;" >æ”¶è—</a>
            <a href=""  style="color:#919191;" id="submitShare"><img class="icon" src="/static/image/share1.png" alt="share" width="15px;" height="15px;">åˆ†äº«</a>
        </div>
    </div><!-- /.blog-main -->
</div><!-- /.row -->
</main>

<div id="layout">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 blog-main">
                <div class="blog-post">

                    <form id="submitForm" action="/article/submit">
                        <div class="form-group">
                            <p style='font-family: STXingkai,"Playfair Display", Georgia, "Times New Roman", serif;font-size: 25px;font-weight: lighter'>æ–‡ç« æ ‡é¢˜</p>
                            <input type="text" class="form-control" id="blogTitle" value="$article.articleTitle"  style="background-color:#E6E6FA">
                        </div>
                        <div class="form-group">
                            <p style='font-family: STXingkai,"Playfair Display", Georgia, "Times New Roman", serif;font-size: 25px;font-weight: lighter'>æ‘˜è¦</p>
                            <input type="text" class="form-control" id="blogSubtitle" value="$article.articleAbstract" style="background-color:#E6E6FA">
                        </div>

                        <div class="form-row">
                            <label for="staticEmail" class="col-sm-2 col-form-label" style='font-family: STXingkai;font-size: 16px;'>ä¸»åˆ†ç±»</label>
                            <div class="form-group col-md-4">
                                <select id="blogMainCat" class="form-control" style="background-color:#E0EEEE;margin-left: -80px;">
                                    #foreach($maincat in $!categoryChoice.getMainCategorys())
                                        #foreach($item in ${maincat.entrySet()})
                                            #if($item.key==$article.articleMainId)
                                                <option selected="selected" value="$item.key">$item.value</option>
                                            #else
                                                <option value="$item.key">$item.value</option>
                                            #end
                                        #end
                                    #end
                                </select>
                            </div>
                            <label for="staticEmail" class="col-sm-2 col-form-label" style='font-family: STXingkai;font-size: 16px;'>äºŒçº§åˆ†ç±»</label>
                            <div class="form-group col-md-4">
                                <select id="blogSecondCat" class="form-control" style="background-color:#E0EEEE;">
                                    #foreach($secondcat in $!categoryChoice.getSecondCategorys())
                                        #foreach($item2 in ${secondcat.entrySet()})
                                            #if($item2.key==$article.articleSecondId)
                                                <option selected="selected" value="$item2.key">$item2.value</option>
                                            #else
                                                <option value="$item2.key">$item2.value</option>
                                            #end
                                        #end
                                    #end
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="form-check">
                                <button type="submit" class="btn btn-primary " id="submitBlog" style="color: #ffffff;background-color: #FF0000;float: right" onclick="return submitCheck()">ğŸ™‚æäº¤æ–‡ç« </button>
                            </div>
                        </div>
                    </form>

                    <div class="form-row" id="tagDiv" >
                        <label for="staticEmail" class="col-sm-2 col-form-label" style='font-family: STXingkai;font-size: 16px;'>æ ‡ ç­¾</label>
                        <div class="form-group col-md-3">
                            <input type="text"  name="tags"  class="form-control" id="inputnewTag"  placeholder="Tags" style="background-color:#E0EEEE;margin-left: -62px;">
                        </div>
                        <a href="javascript:void(0);"  id="addnewTag" class="btn btn-primary btn-group-lg" name="addnewTag" style="height:35px;width:60px;background-color: #1A8BE8;margin-left: -50px;">æ–°  å¢</a>
                        #foreach($tag in $!article.articleTagList)
                            <a class="anewTag" title="$tag.tagName" style="margin-left: 8px">
                                <span type="button" class="btn btn-success btn-sm" style="font-size: 13px;background-color:#555;">$tag.tagName</span>
                                <button type="button" id="closeTag" style="display: none"  class="close" aria-label="Close"><span aria-hidden="true" style="color: #FF0000">&times;</span></button>
                            </a>
                        #end
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div id="layout">
        <div class="btns">
            <button id="goto-line-btn">Goto line 90</button>
            <button id="show-btn">Show editor</button>
            <button id="hide-btn">Hide editor</button>
            <button id="get-md-btn">Get Markdown</button>
            <button id="get-html-btn">Get HTML</button>
            <button id="watch-btn">Watch</button>
            <button id="unwatch-btn">Unwatch</button>
            <button id="preview-btn">Preview HTML (Press Shift + ESC cancel)</button>
            <button id="fullscreen-btn">Fullscreen (Press ESC cancel)</button>
            <button id="show-toolbar-btn">Show toolbar</button>
            <button id="close-toolbar-btn">Hide toolbar</button>
            <button id="toc-menu-btn">ToC Dropdown menu</button>
            <button id="toc-default-btn">ToC default</button>
            <button id="insertBlog">insertBlog</button>
        </div>

        <div id="test-editormd">
            <textarea class="editormd-markdown-textarea" name="test-editormd-markdown-doc"></textarea>
            <!-- ç¬¬äºŒä¸ªéšè—æ–‡æœ¬åŸŸï¼Œç”¨æ¥æ„é€ ç”Ÿæˆçš„HTMLä»£ç ï¼Œæ–¹ä¾¿è¡¨å•POSTæäº¤ï¼Œè¿™é‡Œçš„nameå¯ä»¥ä»»æ„å–ï¼Œåå°æ¥å—æ—¶ä»¥è¿™ä¸ªnameé”®ä¸ºå‡† -->
            <textarea class="editormd-html-textarea" name="text"></textarea>
        </div>

        <div id="test-editormd-originBlog" style="display: none">
            <textarea id="originBlog">$article.getArticleContentCopy()</textarea>
        </div>

    </div>

<script src="/static/Editormd/examples/js/jquery.min.js"></script>
<script src="/static/Editormd/editormd.min.js"></script>
<script src="/static/Editormd/editormd.js" ></script>
<script>
    $(function(){
        var testoriginBlog;
        $("#insertBlog").click(function(){
            var content = $("#originBlog").text();
            testEditor.insertValue(content);å¯ä»¥å°†å†…å®¹æ’å…¥å·¦ä¾§ç¼–è¾‘åŒº
            //$(".editormd-preview-container").html(content); å¯ä»¥å°†å†…å®¹æ’å…¥å³ä¾§é¢„è§ˆåŒº

        });
    });
</script>
<script type="text/javascript">
    var testEditor;

    $(function() {
        testEditor = editormd({
            id      : "test-editormd",
            width   : "90%",
            height  : 640,
            syncScrolling : "single",
            path    : "/static/Editormd/lib/",
            previewTheme: "dark",
            imageUpload : true,
            imageFormats : ["jpg", "jpeg", "gif", "png", "bmp", "webp"],
            imageUploadURL : "/article/uploadBlogFile",
            codeFold : true,
            saveHTMLToTextarea : true,    //å°†htmlå­˜å…¥ç¬¬äºŒä¸ªtextareaä¸­ä»¥æ–¹ä¾¿æäº¤è¡¨å•
            emoji : true,
            taskList : true,
            tocm: false,                   // Using [TOCM]è‡ªåŠ¨ç”Ÿæˆå·¦ä¾§å†…å®¹å¯¼èˆªæ 
            tex : true,                   // å¼€å¯ç§‘å­¦å…¬å¼TeXè¯­è¨€æ”¯æŒï¼Œé»˜è®¤å…³é—­
            flowChart : true,             // å¼€å¯æµç¨‹å›¾æ”¯æŒï¼Œé»˜è®¤å…³é—­
            sequenceDiagram : true,       // å¼€å¯æ—¶åº/åºåˆ—å›¾æ”¯æŒï¼Œé»˜è®¤å…³é—­,


        });

        $("#goto-line-btn").bind("click", function(){
            testEditor.gotoLine(90);
        });

        $("#show-btn").bind('click', function(){
            testEditor.show();
        });

        $("#hide-btn").bind('click', function(){
            testEditor.hide();
        });

        $("#get-md-btn").bind('click', function(){
            alert(testEditor.getMarkdown());
        });

        $("#get-html-btn").bind('click', function() {
            alert(testEditor.getHTML());
        });

        $("#watch-btn").bind('click', function() {
            testEditor.watch();
        });

        $("#unwatch-btn").bind('click', function() {
            testEditor.unwatch();
        });

        $("#preview-btn").bind('click', function() {
            testEditor.previewing();
        });

        $("#fullscreen-btn").bind('click', function() {
            testEditor.fullscreen();
        });

        $("#show-toolbar-btn").bind('click', function() {
            testEditor.showToolbar();
        });

        $("#close-toolbar-btn").bind('click', function() {
            testEditor.hideToolbar();
        });

        $("#toc-menu-btn").click(function(){
            testEditor.config({
                tocDropdown   : true,
                tocTitle      : "ç›®å½• Table of Contents",
            });
        });

        $("#toc-default-btn").click(function() {
            testEditor.config("tocDropdown", false);
        });
    });

</script>


</body>
</html>
